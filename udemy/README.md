<span style="color: green">&#x1F535; AWS SYSOPS  
</span>

## Function Reference
PLAN:
* [Compute](#Compute)
* [Network](#Network)
* [Troubleshooting](#Troubleshooting)
* [Cloudwatch](#Cloudwatch)
* [SSM&OpsWOrks](#SSM&OpsWOrks)
* [HA](#HA)
* [ElasticBeanstalk](#ElasticBeanstalk)
* [CloudFormation](#CloudFormation)
* [EBS](#EBS)
* [S3](#S3)
* [Snow-Family](#Snow-Family)
* [Cloudfront](#Cloudfront)
* [RDS](#RDS)
* [Cloudwatch](#Cloudwatch)
* [Account-Managment](#Account-Managment)
* [Disaster-recovery](#Disaster-recovery)
* [Security/Shared/Identity](#Security/Shared/Identity)
* [Route53](#Route53)
* [Network](#Network)

<span style="color: black">&#x1F535; 
# Compute
</span>

* change instance type ONLY EBS: stop
* burstable CPU credit- monitor CPU health if unlimited


### types:

* Reserved types: long up 75% 1-3y
upfront, no upfront
* Convertible long with flexible can change type, 54%
* Scheduled friday 12-3
* Dedicated host
* Dedicated instance

### Spot 90% max spot pricem spot block timeframe

* terminate spot request, then instance
* Spot Fleets(lower-price/diversified/optimized) set of spottypes + demand(optional)


### AMI

* Migrate to a new AZ (Create AMI not reboot > migrate)
* Image builder for creation AMI on schedule (test > creation)
* Production: pre-approved by IAM and AWS config

### Placement group

* cluster-single  AZ same hardware 10GBs (BIG DATA, FAST)
* Spread- differant hardware 7 per AZ hight availability
* Partition(Hadoop, Kafka, Cassandra) many AZ, no share hardware 

### enchanced network SR-IOV

* ENA mod up 100GBs
* Intel 82599 up 10GBs
* EFA only linux

```
modinfo ena
ethtool -i eth0
```

<span style="color: black">&#x1F535; 
# Troubleshooting
</span>

### ec2 Terminates immediately

* EBS limit
* EBS corrupt or decrypt
* AMI is missing


<span style="color: black">&#x1F535; 
# Cloudwatch
</span>


* cloudwatch(procstat) agent for new METRICS: MEM, DIS and LOGS: nginx-error.log
* status check: alarm, restart, scale
* hibirnation(save RAM to DISK) RAM inside EBS volume, will fast starting (RAM loads from VOLUME)


<span style="color: black">&#x1F535; 
# SSM&OpsWOrks
</span>

* Create role with policy AmazonEC2RoleForSSM
* Resource group tag base
* SSM document like CloudFormation allow run sh
* SSM command like ansible to run commands without ssh
* SSM store credentials
```
aws ssm get-parameters --name /app/dev /app/prod --with-decryption
```
* SSM inventory: metadata, software, store data in s3
* SSM State Manager monitor instance state, application and versions, at time
* SSM Session manager ssh thougth aws cli, console, SSM SDK without keys
* all works from SSM agent
* Patch manager to patching onstances

* OPSWorks for CHEF and puppet

<span style="color: black">&#x1F535; 
# HA
</span>

* HA many AZ

### LB https > LB > http > target

* LB internal, external: Gateway, Clasic, Application, Network
* Outofservice uf port not opened SG
* Allow trafic only from LB
* Application: /admin /home, query id=123&order=false
* LB secure, don't have IP
* LB Gateway(GENEVE 6081) packet inspect, firewall, analyzer 
* Sticky Sessions(Affininy-target group enable) client to the same instance, for session data, cookie generated by LB
* NLB pay for AZ data
* SNI multiple SSL certificates
* Connection draining - stop sending a new requests, de-registration
* APPUSERC application-based cookie i

### ERROR CODE

* 4XX client side
* 5XX servir side

### Metrics

* backendConnectionError
* request number
* Latency
* Access log to AWS S3, pay for only S3
* SpilloverCount  total number of request
* RAM > Request Per instance

### Target group

* deregistration time
* slow_start.duration_seconds
* stickiness.enabled
* LB.algorithm.type (Round Robin, Least, flow hash based IP,port)
* weight
* warm up configure slow start in target group

### Autoscaling ASG

* Can be based on Cloudwatch alarms and custom metrics
* Cloudwatch, Time, Predictable scaling
* Adivice use ready-to-use AMI for quickly
* use script in progress/terminated state
* Target Group on lambda
* Troubleshoot ASG hook to pause the instance in the termination state

# ElasticBeanstalk

LB/Elastic IP > ASG > instance

* Use pre-pared AMI golden for faster deploy

# CloudFormation

* Changes set preview
* CloudFormation knows what tp create firstly
* Not supported resource use AWS Lambda Custom Resources
* cfn-init.yaml like ansible for AWS CloudFormation
var/logcfn-init.log
* we can tell CloudFormation cfn-init status
cfn-signal -e $? --stack $P{AWS::StackId} --resource SampleWaitCondition exit1
* Nested stack TemplateURL like Terraform module import
* ChangeSets rollbacl to work version when updating
* Detect drift to view changes
* Deletion policy: Retain-keep; Snapshot-volume; Delete-default-delete
* Creation policy signal count for creation
* Update policy: Replacing, Rolling, Scheduled
* Prevent Update stack-policy.yaml add to Stack policy 
* StackSets for multiple regions

```
Conditions:
  CreateProdResources: !Equals [ !Ref]
AvailabilityZone:
  !GetAtt EC2Instance.AvailabilityZone

```

<span style="color: black">&#x1F535; 
# EBS
</span>

* Instance Store for the better performance IOPS, special types
* GP3 5334 GB max 16000 IOPS
* io1/io2 for database workloads, can be attached to multiple instances, must use cluster-aware (not EX4,XFS)
* EBS migration > snapshot AZ > create a new volume

### EFS

* EFS-NFSv4 POSIX: types: General-web, MAX I/O-big-date,media
*  Stadart-frequental, infrequent access, no-access for 60 days up 90% in cost savings
* Access Points restrict access using IAM, access to specific directory, +  POSIX

> https://aws.amazon.com/ebs/volume-types/


# S3



* SSE-S3 maanged by AWS, server side AES-256 HEADER x-ams
* SSE-KMS managed by KMS, user control server side AES-256 HEADER:aws:kms
* SSE-C custom key, client-side AWS not store key you provided, the key need to be provided in HTTP header for every HTTP request. Encrypted before upload to S3
* SSL/TSL S3 endpoint
* S3 index > create public > policy to get object
* Policy for force encryption by HEADER
* Log bucket: Bucket > server access logging
* S3 Inventory (For bucket analytics): Identify the total storage, object number, replication reports
* S3 Inventory: Managments > Inventory configuration > Destination
* S3 has automaticaly scales 3500 PUT/DELETE 5500 GET per secund
* SSW-KMS limits 5550, 10000 req/sec
* multi-part upload for > 100MB
* Transfer Acceleration upload increase by creating Edge location beetwen regions
* S3 Byte-Range Fetches speed up download
* S3 Glacier select for filtering
* S3 Analytics > Analytics > add filter How many days to send to another storage class 
* S3 Glacier vaults policy denny delete archive forever for 365 days LOCK POLICY
* Each Access Points have own DNS and access limits policy, can be INTERNET OR VPC
* Allow access from source VPC policy: aws:SourceVpce

### CORS: browser based security

```
Access-Control-Allow-Origin: https://www.example.com
Access-Control-Allow-Methods: GET,PUT,DELETE
```

### MFA

* delete/disable version using the CLI

### S3 Replication

* Can be in diffrent accounts
* Copying in asynchronoues
* Must be enable version
* only new object will be replicated or using S3 Barch Replication
* Deletion can be replicated

### S3 pre-signed

* default expiration of 3600 seconds
* Users inherit permisions from IAM
* Temprery users

* Bucket, open private file, it will give  pre-signed access
* Object action > share with a pre-sign url

### Storage classes

* Standart-Frequental: content, big-data, gaming
* Standart-Infrequent rapid access when needed
* One zone infrequent: buckup,*  store the second buckp
* Glacier instant retrieval once a quater minimun 90 days
* Glacier flexible expedited 1-5 min, standart 3-5 hours, build 5 -12 hours is free
* Glacier Deep arhive 12 hours, build 48 hours
* Intelligent-tier automatically

# Snow-Family

* offline migration device
* Snowcone small device 8TB
* Snowball Edge Storage Optomized 80 TB
* SNowball Edge Compute Optimized 42 TB
* Snowmobile 100 PB

# FsX like EFS for windows

* Fully managed Windows file system
* Microsoft Active Directory instegration
* FsX Lustre-linux and cluster
* FsX Lustre integration with S3
* FsX short-term processing wihtout data replication


<span style="color: black">&#x1F535; 
# Cloudfront 
</span>

CDN content delivery content
Create Distribution > WEB >bucket > restrict access > Redirect HTTP to HTTPS

* automatically create S3 bucket policy
* By origin access ID
* Reports: cache, popular object, top, usage, viewer from access log
* enable standart logging FIND in S3 bucket
* Caching TTL max age header
* Cookie key-value: username:Jon
* CloudFront with ALB sticky sessions need to use whitelist
* Cloudfron invalidation to appy imidiatelly

Cloudfront Header value for all request
vs Cache Behavior (Accept, Accept-datetime)

<span style="color: black">&#x1F535; 
# RDS
</span>

* Force SSL connections rds.force_ssl-1 
```
GRANT USAGE ON *.* to 'mysql'@'%' REQUIRE SSL;
```
* restore point time 5 minutes
* db snapshots manually by user
* storage autoscaling increase storage on RDS DB all DB
[less than 10%, low-storage lasts at least 5 minutes, 6 hours passed] 

* Read relicas for scalability more RDS, need update connection string read relicas only SELECT statement
* Free if replica in the same region
* DNS name automaticaly failover if master will fail

### Encryption

* At rest encryption master with AWS KMS AES 256
* In-flight encryption SSL in flight, enforce using SSL



* encrypt an un-encrypted
[create a snapshot, copy snapshot and enable encryption, restore database from encrypted snapshot]
* IAM-based autherntecation can used to login into RDS with authentication token

### Responsibility

AWS

* no SSH, manul DB/OS patching, audit instance

### RDS proxy

* AWS Lambda can connect in the same VPC though Elastic Network Interface (ENI)

* Use RDS proxy, deploy RDS Proxy to public subnet > then connect to RDS DB instance

### Parameter groups

* Assign paramaters to database
* set value 1 to enable
* CLick to Database to find parameters

### backups vs snapshoot

* snapshoot stop database
* snapshoot copy/share
* full snapshoot when you deleting
* backup to specific time

### Events/Cloud watch

* DB instance (State/Pending)
* Snapshoot/backup created

Metrics:

* Connections
* SwapUsage
* ReadIOPS/WriteIOPS
* DiskQuequeDepth
* FreeStorageSpace
* Enchanced monitor to see diffrent process/threads use the CPU

### Performance Insight

* Finding botlenack in tables, process, iops, hosts, SQL queries
* not supported for db.t2.micro

### AWS Aurora

* Postgres/Mysql
* Optimized/Performance improvment
* Automatically grows 10G to 64 TB
* Cost more than RDS
* 6 copies of your data
* Self healing data
* AUtora master if fail automatic failover less then 30 seconds and redirected automatically
* Advanced monitoring/maintenance/backtrack/push-button scaling

### ElastiCache 



> get queries from ElastiCache, if not present > get from RDS > save to ElastiCache missed cache

* METRICS REDIS: Eviction- number non expired items, CPU, SwapUsage, CurrentConnections, DatabaseMemoryUsage, networkIN/OUT, Replication
* METRICS MEMCACHE: CPU, SwapUsage, Conneciton, FreeMemory

* in-memory database
* reduce loads
* Redis like RDS with backup and restore and high availability
* Memcached no backup, no HA, no persistent
* Disabled cluster 0-5 nodes

* Enabled cluster: data shared partitioned
* Online scaling no downtime
* Offline with downtime
* Horizontal support BOTH
* Vertical Support Online

<span style="color: black">&#x1F535; 
# Cloudwatch
</span>

* Create alarm on Service Quotas
* EC2 5 min metrics
* Custom metric use put-metric-date AWSCLI 
* Cloudwatch logs send to: S3, Lambda, Kinesis, ElasticSearch
* Metric Filter to find specific IP in logs and create a new Metric
* Create alarm depends on LOG filter
* Events > Choose event type JSON > Target (Lambda, Snapshoot, SNS)

### EventBridge 

updated AWS events

* Send data beetween accounts
* Default Event Bus my account
* Download code bindings: Java, Python
* Custom Event Bus for your applications, Partner Bus for DataDog
* Can share with others AWS accounts
* Can analyze data
* Schema Registry allows to generate code for your APP


### CloudTrail 

* Default 90days next to S3 and Use Athena to analize
* Console, awscli, sdk events to S3
* Managment event: AttachRole
* Data event: GetObject, DeleteVolume, Lambda
* Insights Events: User activity
* Can trigger event bridge
* To check cloudtrail logs in s3, use Log File Integrity Validation

### AWS Config

keep configuration evaliate compliance

* Remediation actions
* unrestricted SSH
* public buckets
* ALB changes
* receive alert if smth change

<span style="color: black">&#x1F535; 
# Account-Managment
</span>

### AWS Personal Health

* https://status.aws.amazon.com <--- Region health
* AWS Personal Health Dashboard <--- Global service, shows impact services, maintenance events, API access create event bribge with notification
* Lambda to sent to Slack

### AWS Organization

* The main account
* Member account part of AWS Organization
* Single payment
* Discaount for ec2, s3
* Automate AWS account creation
* MIGRATE account: remove account from old Organization, except from new one, go to invitation
* Use Organization Utits
* Can share reserved instances
* Create TAG, prevent creation without tag
* Biling only in US-EAST-1

### Service Control List

Resctict access to certain services

* Account level
* SCP applied to all Users including root

###  SCP Hierarchy

ROOT OU (full access) > PROD OU (RedshiftDeny) > HR OU can not use Redshift

### AWS Control Tower

Multiaccount the best practise

### AWS Service Catalog

* Pre-defined services by Admin for users: database, storage via CloudFormaition, for users with lack of knowledge in AWS
* Portfolio with collection of products
* Can be shared in Organization

### Cost Explorer

* manage AWS account costs
* report/analyze
* saving plan
* Forecast

### AWS Budget

Send Alarm when cost exceeds

* 2 Budget are free
* Cost, Usage, Reservation, Saving Plan

### Allocation Tags 

Track cost details by your Tags

* User tags and AWS generated tags
* Create report, use Athena, S3

### Compute Optimizer

Reduce cost and improve performance

### AWS Service Health Dashboard

find outages  services like ElastiCache

### AWS Trusted Advisor

* Analyze: Cost, Performance, Security, Fault Tolerance, Service LIMITS
* Recomendation

<span style="color: black">&#x1F535; 
# Disaster-recovery
</span>

### AWS DataSync

* SYNC: S3, EFS, Glacier, FSx via NFS or SMB
* NFS with DataSync agent > REGION AWS DataSync > S3, EFS, FSx
* EFS > Datasycn endpoint with another EFS

### AWS Buckup

* PITR backup
* database, S3, EFS, EC2, EBS
* Template with retation, build a new plan, Define JSON
* Daily, Mounthly
* Working with Tags and Jobs

<span style="color: black">&#x1F535; 
# Security/Shared/Identity
</span>

### AWS Shared moded

Customer
* Security in Cloud: EC2, IAL
* Port, IP, SG
* User Permisions
* Bucket policy/enabling encryption
AWS
* S3 encrypt
* Not allow AWS employees access to S3
* Security in Cloud: S3, DynamoDB, RDS
* patching: OS, DB. EC2, disck
Shared:
Configuratiom, Training, Patching


### AWS Shield

Free standart

DDOS Protection

Route 53 AWS Shield > CloudFront AWS Shield with AWS WAF > LB AWS Shield > Autoscaling

### AWS WAF

* Filter specific requests
* Protect application from common web expoits

WEB ACL Web Access Control List
* SQL injection
* Cross-Site Scripting XSS
* geo-match
* based DDOS rules

### Penetration Testing

* Allow EC2, Nat Gateway, LB, RDS, Api Gateway, Lambda, Elasticbean
* Deny: DNZ zone walking, Port/Protocol/Requests flooding,

### AWS Inspector

Security Assesment

* SSM agent running OS, push to ECR
* Reporting with AWS Security Hub
* Send findings to AWS Event bridge
* SSM pre-installed on AWS Linux

### Logging in AWS

* CloudTrail: all API call
* ConfigRule: config & compliance
* CloudWatch full data retention
* VCP Flow Logs: IP traffic
* ELB Access Logs: metadata for LB
* CloudFront: web distribution access logs
* WAF

LOGS can be stored in S3 and filter by Athena

### AWS GuardDuty

* Analyze AWS Account 30 days trial
* DNS logs
* K8S logs
* VPC logs
* Cloud trail
* Push keys to repository deny

### AWS Macie

* Protect sensitive data like PII personal identifiable information

### AWS KMS

* KMS FIPS 140-2 level 2
* Symetric AES-256 one key
* Asymmetric RSA & ECC two key
* Create/Imported $1/month, $0.03 10000 APIcall
* Share password with KMS
* 1year rotation ONLY
* Share key then snaphoot
* FIPS 140-2 level 3 STOP/BLOCK
* KMS Key Policies


```
# 1) encryption
aws kms encrypt --key-id alias/tutorial --plaintext fileb://ExampleSecretFile.txt --output text --query CiphertextBlob  --region eu-west-2 > ExampleSecretFileEncrypted.base64
```

### AWS CloudHSM

* dedicated hardware module

```
Что такое облачный HSM?
Cloud HSM — это служба аппаратного модуля безопасности (HSM), размещенная в облаке, которая позволяет размещать ключи шифрования и выполнять криптографические операции в кластере модулей HSM, сертифицированных по стандарту FIPS 140-2 уровня 3
```

### AWS Artifact

* Download compliance reports
* Artifact agreements: review status of AWS agreements such as BAA or HIPAA for individual accounts

### AWS ACM certificate manager

* Secrets for: RDS, Redshift, other credentials
* METRICS: Conceled, End Secret, Rotation

# Identity

* IAM Credentials Report
Report list of account to get not MFA users

* IAM Access Advisor
Service permissions

* IAM Acces Analyzer to check permissions, check users outside AWS

### Indentity Federations

* Allow users outside of AWS to assume temprory role accessing AWS resources
* LDAP, SSO, OPENID, COGNITO
* identity broker must has IAM policy

### AWS STS Security Token Service

* Limited or Temprery access to AWS valid up 1 hour
* Assume Role
* AssumeRoleWithSAML Indentity Federations
* AssumeRole with Webidentity
* GetSession Token

### Cognito

Create serveless database Conginto User Pools(CUP) of users for you web/mobile users

* Usename/Password
* Password reset
* Email/Phome number verificatio
* MFA
* Federated identities: Google, SAML, Facebook
* JSON JWT token
* Defined Roles for access User
* Cognito Identity pool obtain credentials for users in Cognito User Pools

### AWS SSO

Free

<span style="color: black">&#x1F535; 
# Route53
</span>

### Record

* A, AAAA-ipv6, CHAME a host with A, NS
* Public hosted zone internet
* Private Hosted zone app1.company.internal $0.50 per zone
* TTL cache seconds for updatin 120 sec
* CNAME only for non root, redirect to app.example.com, ALIAS to AWS services root example.com (LB, CloudFront, Beanstock, S3, Gateway, VPC andpoing, )

### Routing Policy

Many IP in one record


* Weight Policy by percentage, health check, 0% weight to stop sending 
* Latency Policy redirect to the near service, IP to regions, to minimize the time
* Simple Policy to a single resource
* Geolocation Policy where User located, need to create default route, can be deny by country
* Geoproximity by AZ, us-west-1, us-east-1, devided by bios: 0, bios: 50 Near, increaase Bios will increase DNS MAP
* Multi-Value to multiple resources assosiated with Health checks use valie only HEALTH, doesn't work with ELB

### Resolver Inbound Endpoints

* works with Private Hosted Zone in deferant VPC
* by default resolver works with instance domain
* use VPN or DX connections 


### Health check

* 15 global health
* 30 sec interval
* Check endpoint
* need to allow Route 53 connect to resource
* Calculated Health

### Traffic flow

* To view how it connected, by Route 53

<span style="color: black">&#x1F535; 
# Network
</span>

* 23.44.22.11/32 one IP

### VPC

* Default VPC has internet connectivity and public IP for all instances
* Min.size /28 (16 IP)
* Max.size /16 (65536)
* 10.0.0.0 - 10.255.255.255 (10.0.0.0/8)
* 172.16.0.0 - 172.31.255.255 (/12)
* 192.168.0.0 - 192.168.255.255 (/16)
* Tenancy default/dedicated (expensive)
* AWS reserved the first 4 and last 1 IP (10.0.0.0 network, 10.0.0.1 router, 10.0.0.2 mapping for DNS provider, 10.0.0.3 for the future, 10.0.0.255 broadcast )

### Public VPC

* Assign IP by default > Modify subnets > enable auto-assign
* Create a new Internet gateway and attach to VPC
* Create a new route table
* Edit assosiations VPC to Internet gateway

### Nat instance with EIP network address translation

* from private subnet to public
* find specific AMI
* stop source/destination check
* add nat instance to Private Route table
* 0.0.0./0 > i-0211s4534ddfd
* add security commands

### Nat Gateway

* Create Nat Gateway > Connectivity Public > alocate EIP
* Edit Route to Nat Gateway

### DNS Resolution

* enable DnsSupport is DNS service to get IP
* enable DNSHostnames if true by default create private dns for a instace
* EDIT VPC
* Create Private hosted zone ana assosiate


### Security Group

* The first requests goes to the NACL
* SG request to  Inbound will will go through outbound automatically
* instance level
* support allow
* eveluated before

### NACL

* subnet level
* Default NACL eccepts everything inboud/outboud
* support allow/deny
* eveluated lower to highest
* apply to all instances

> NACL and SG work together


### Ephemeral Ports 

Request: 192.168.0.21:50105 to 8.8.8.8:443

* Windows uses 49|52 - 65535
* Linux uses 32768 - 60999

### VPC Reachability Analyzer

* check connectivity not sending package
* $0.10 per a analyzer
* create analyzer path
* veiw full network path

### VPC endpoints

* Connect to AWS resource though internet > Private Subnet > Nat > Public > IG expensive
* Create VPC endpont to direct connection to a VPC cost savings

Types:

* interface provision an ENI support many services, must attach a security group
* gateway endpoint only S3 and DynamoDB

### VPC Flow Logs

* send to S3 > Athena

### VPN

customer gateway CGW
* need datacent and devoc

* virtual private gateway
need enable route propogation

when you have customer gateway CGW and virtual private gateway create site-to-site VPN

* VPN concentrator on the AWS side
* VGW attached to the VPC

### Direct connect DX

* private connection from remote to your VPC
* setup Virtual Private Gateway on your VPC
* to connect to one or more VPC use Direct Connection Gateway
* Dedicated connection 1-10GB:  physical ethernet port more then mounth to establish, not encrypted
* Hosted connection50, 500,10 GB:
AWS direct  connect partner


VPN CloudHub

* multiple networks

### AWS PrivateLink (VPC Endpoint Services)

* Doesn't require peering, internet gateway, NAT, route tables
* most scalable
* need network LB and ENI or GWLB

### EC2-Clasic && ClassicLink

* EC2-Clasic: run in a single shared network
* ClassicLink allows you to link EC2-Clasic

### Transit Gateway

* Peering for thousands of VPC
* Works with Direct Connect gateway, VPN
* VPN ECMP equal-cost multi-path routing for multiple VPN 

### VPC Traffic Mirroring

* Capture and inspect traffic
* Source and Target can be everywhere

### ipv6

* can has both ipv4 and ipv6

### Egress-only Internet Gateway

* For ipv6

kubectl -n cgbu-analytics--* exec -ut 